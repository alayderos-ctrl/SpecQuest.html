<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Level 1 - Electromagnetic Spectrum</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet" />
<style>
  /* Basic Reset and styles */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    height: 100vh;
    width: 100vw;
    font-family: 'Orbitron', sans-serif;
    overflow: hidden;
    background: linear-gradient(135deg, #000428, #004e92);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 10px;
  }

  #particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
  }

  .game-container {
    position: relative;
    z-index: 2;
    width: 95%;
    max-width: 1200px;
    min-height: 600px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  #title {
    color: #fff;
    font-family: 'Orbitron', sans-serif;
    font-size: 24px;
  }

  #timer, #stars, #total-score {
    color: #fff;
    font-family: 'Orbitron', sans-serif;
    font-size: 20px;
  }

  #buttons {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }

  button {
    padding: 12px 24px;
    font-family: 'Orbitron', sans-serif;
    font-size: 14px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background: linear-gradient(135deg, #f7971e, #ffd200);
    color: #fff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    transition: transform 0.2s, box-shadow 0.2s;
  }
  button:hover {
    transform: scale(1.05);
  }

  #tiles-container {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
    width: 100%;
  }

  .tile-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    user-select: none;
    width: 160px;
  }

  .tile-number {
    font-family: 'Orbitron', sans-serif;
    font-size: 20px;
    color: #fff;
    margin-bottom: 8px;
    font-weight: bold;
  }

  .tile {
    padding: 25px 35px;
    border-radius: 15px;
    color: #fff;
    font-weight: bold;
    font-size: 20px;
    min-width: 150px;
    text-align: center;
    font-family: 'Orbitron', sans-serif;
    box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    transition: background-color 0.3s, transform 0.2s, outline 0.2s;
  }

  #feedback {
    position: absolute;
    top: 10%;
    width: 80%;
    max-width: 600px;
    padding: 20px;
    background: rgba(0,0,0,0.7);
    border-radius: 15px;
    text-align: center;
    font-size: 20px;
    color: #fff;
    display: none;
    z-index: 5;
  }

  #stars {
    margin-top: 10px;
    font-size: 24px;
    color: #ffd700;
  }

  #triviaSection {
    margin-top: 20px;
    background: #444;
    padding: 15px;
    border-radius: 10px;
    max-width: 800px;
    width: 90%;
    display: none;
  }

  #triviaSection h3 {
    margin-bottom: 10px;
  }

  #triviaContent {
    font-size: 1em;
    color: #fff;
  }
</style>
</head>
<body>

<canvas id="particles"></canvas>

<div class="game-container">
  <div id="header">
    <div id="title"></div>
    <div>
      <div id="timer">Time: 30</div>
      <div id="stars">Stars: ★★★</div>
      <div id="total-score">Total Score: 0</div>
    </div>
  </div>
  <div id="instructions" style="color:#fff; margin-bottom:10px;"></div>
  <div id="tiles-container"></div>
  <div id="buttons">
    <button id="submit-btn">Check</button>
    <!-- Removed the "Try Again" button -->
    <button id="next-level-btn" style="display:none;">Next Level</button>
  </div>
</div>

<div id="triviaSection">
  <h3>Did You Know?</h3>
  <div id="triviaContent">
    The electromagnetic spectrum encompasses all types of electromagnetic radiation, from radio waves to gamma rays. Different types have different wavelengths and energies, important for many technological and medical applications.
  </div>
</div>

<div id="feedback"></div>

<audio id="bg-music" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" autoplay loop></audio>

<script>
  // Level configuration object
  const levelConfig = {
    title: "Electromagnetic Spectrum",
    instructionsText: "Order electromagnetic spectrum (coldest to hottest)",
    correctOrder: [
      'Radio waves',
      'Microwaves',
      'Infrared',
      'Visible light',
      'Ultraviolet',
      'X-rays',
      'Gamma rays'
    ],
    timerSeconds: 30,
    starThresholds: {
      threeStars: 22,
      twoStars: 17,
      oneStar: 10
    },
    tileColors: [
      '#FF5733', '#FF8D33', '#FFC300', '#DAF7A6', '#33FF57', '#33FFF6', '#3380FF'
    ],
    backgroundGradient: 'linear-gradient(135deg, #000428, #004e92)',
  };

  // Apply config to elements
  document.getElementById('title').textContent = levelConfig.title;
  document.getElementById('instructions').textContent = levelConfig.instructionsText;
  document.body.style.background = levelConfig.backgroundGradient;

  // Parse URL parameters for totalScore
  function getUrlParameter(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  let totalScore = 0;
  const scoreParam = getUrlParameter('score');
  if (scoreParam !== null) {
    totalScore = parseInt(scoreParam, 10);
  }
  document.getElementById('total-score').textContent = `Total Score: ${totalScore}`;

  // Particles background code
  const canvas = document.getElementById('particles');
  const ctx = canvas.getContext('2d');

  let particlesArray;
  const maxParticles = 80;

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  class Particle {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 2 + 1;
      this.speedX = (Math.random() - 0.5) * 0.5;
      this.speedY = (Math.random() - 0.5) * 0.5;
    }
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      if (this.x > canvas.width) this.x = 0;
      if (this.x < 0) this.x = canvas.width;
      if (this.y > canvas.height) this.y = 0;
      if (this.y < 0) this.y = canvas.height;
    }
    draw() {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,255,255,0.2)';
      ctx.fill();
    }
  }

  function initParticles() {
    particlesArray = [];
    for (let i=0; i<maxParticles; i++) {
      particlesArray.push(new Particle());
    }
  }

  function handleParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let p of particlesArray) {
      p.update();
      p.draw();
    }
    for (let a=0; a<particlesArray.length; a++) {
      for (let b=a+1; b<particlesArray.length; b++) {
        const dx = particlesArray[a].x - particlesArray[b].x;
        const dy = particlesArray[a].y - particlesArray[b].y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < 100) {
          ctx.beginPath();
          ctx.strokeStyle = `rgba(255,255,255,${1 - dist/100})`;
          ctx.lineWidth = 1;
          ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
          ctx.lineTo(particlesArray[b].x, particlesArray[b].y);
          ctx.stroke();
        }
      }
    }
    requestAnimationFrame(handleParticles);
  }
  initParticles();
  handleParticles();

  // Game variables
  let tilesData = [];
  const tilesContainer = document.getElementById('tiles-container');

  // Timer variables
  let totalTime = levelConfig.timerSeconds;
  let timerInterval = null;

  // Score stars
  let starsCount = 0;
  let selectedTileIndex = null;

  // Initialize tiles
  function initTiles() {
    const shuffled = [...levelConfig.correctOrder].sort(() => Math.random() - 0.5);
    tilesData = shuffled;
    renderTiles();
  }

  function renderTiles() {
    tilesContainer.innerHTML = '';
    tilesData.forEach((text, index) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'tile-wrapper';

      const label = document.createElement('div');
      label.className = 'tile-number';
      label.textContent = `#${index + 1}`;

      const tile = document.createElement('div');
      tile.className = 'tile';

      // Set background color from config
      tile.style.backgroundColor = levelConfig.tileColors[index % levelConfig.tileColors.length];

      tile.addEventListener('click', () => handleTileClick(index));
      tile.textContent = text;
      tile.dataset.index = index;

      wrapper.appendChild(label);
      wrapper.appendChild(tile);
      tilesContainer.appendChild(wrapper);
    });
  }

  function handleTileClick(index) {
    if (selectedTileIndex === null) {
      selectedTileIndex = index;
      highlightTile(index);
    } else if (selectedTileIndex === index) {
      unhighlightTile(selectedTileIndex);
      selectedTileIndex = null;
    } else {
      [tilesData[selectedTileIndex], tilesData[index]] = [tilesData[index], tilesData[selectedTileIndex]];
      unhighlightTile(selectedTileIndex);
      selectedTileIndex = null;
      renderTiles();
    }
  }

  function highlightTile(index) {
    const tileDivs = document.querySelectorAll('.tile');
    if (tileDivs[index]) {
      tileDivs[index].style.outline = '3px solid #fff';
    }
  }

  function unhighlightTile(index) {
    const tileDivs = document.querySelectorAll('.tile');
    if (tileDivs[index]) {
      tileDivs[index].style.outline = 'none';
    }
  }

  function startTimer() {
    clearInterval(timerInterval);
    totalTime = levelConfig.timerSeconds;
    document.getElementById('timer').textContent = `Time: ${totalTime}`;
    timerInterval = setInterval(() => {
      totalTime--;
      if (totalTime >= 0) {
        document.getElementById('timer').textContent = `Time: ${totalTime}`;
      }
      if (totalTime < 0) {
        clearInterval(timerInterval);
        checkSolution(true);
      }
    }, 1000);
  }

  function calculateStars() {
    if (totalTime >= levelConfig.starThresholds.threeStars) return 3;
    if (totalTime >= levelConfig.starThresholds.twoStars) return 2;
    if (totalTime >= levelConfig.starThresholds.oneStar) return 1;
    return 0;
  }

  function updateStarsDisplay() {
    const starStr = '★'.repeat(starsCount);
    document.getElementById('stars').textContent = 'Stars: ' + starStr;
  }

  function updateTotalScore() {
    totalScore += starsCount;
    localStorage.setItem('totalScore', totalScore);
    document.getElementById('total-score').textContent = `Total Score: ${totalScore}`;
  }

  function checkSolution(auto=false) {
    clearInterval(timerInterval);
    let correctWavesCount = 0;

    // Count how many waves are correctly placed
    for (let i=0; i<tilesData.length; i++) {
      if (tilesData[i] === levelConfig.correctOrder[i]) {
        correctWavesCount++;
      }
    }

    // Assign points based on number of correctly placed waves
    if (correctWavesCount === 7) {
      starsCount = 3;
    } else if (correctWavesCount === 5) {
      starsCount = 2;
    } else if (correctWavesCount === 3) {
      starsCount = 1;
    } else {
      starsCount = 0;
    }

    updateStarsDisplay();
    updateTotalScore();

    const feedbackDiv = document.getElementById('feedback');
    feedbackDiv.style.display = 'block';

    if (correctWavesCount === levelConfig.correctOrder.length || auto) {
      feedbackDiv.innerHTML = 'Correct! Well done!';
      document.getElementById('next-level-btn').style.display = 'none';

      // Store score in localStorage before redirect
      localStorage.setItem('scoreLevel2', totalScore);

      setTimeout(() => {
        window.location.href = 'level2.html?score=' + totalScore;
      }, 2000);
    } else {
      // Show score and redirect
      feedbackDiv.innerHTML = `Your score: ${starsCount} stars. Redirecting to next level...`;
      
      // Store score in localStorage before redirect
      localStorage.setItem('scoreLevel2', totalScore);
      
      setTimeout(() => {
        window.location.href = 'level2.html?score=' + totalScore;
      }, 2000);
    }
  }

  document.getElementById('submit-btn').addEventListener('click', () => {
    checkSolution();
  });
  // Removed event listener for "Try Again"

  function restartLevel() {
    initTiles();
    startTimer();
    document.getElementById('feedback').style.display = 'none';
    totalTime = levelConfig.timerSeconds;
    document.getElementById('timer').textContent = `Time: ${totalTime}`;
    starsCount = 0;
    updateStarsDisplay();
    document.getElementById('triviaSection').style.display = 'none';
  }

  // Initialize game
  initTiles();
  startTimer();

</script>
</body>
</html>